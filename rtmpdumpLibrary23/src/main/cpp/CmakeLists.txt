project(rtmpdump)
cmake_minimum_required(VERSION 3.1.3)

#include(rtmpdump.cmake)

add_definitions("-DRTMPDUMP_VERSION=\"${VERSION}\"" "-DNO_CRYPTO")

set(SRC_ROOT ${CMAKE_CURRENT_LIST_DIR}/rtmpdump-2.3)
include_directories(${SRC_ROOT}/librtmp)
include_directories(${SRC_ROOT})

file(GLOB LIBRTMP_HEADERS "${SRC_ROOT}/librtmp/*.h*" )
file(GLOB LIBRTMP_SRCS "${SRC_ROOT}/librtmp/*.c*")

message(STATUS ${LIBRTMP_HEADERS})
message(STATUS ${LIBRTMP_SRCS})

set(EXTRA_LIBS ${EXTRA_LIBS} stdc++ z pthread dl)

set(LIB_RTMP librtmp)

add_library(${LIB_RTMP} SHARED
        ${LIBRTMP_HEADERS}
        ${LIBRTMP_SRCS})

install(TARGETS ${LIB_RTMP}
        RUNTIME DESTINATION bin
        LIBRARY DESTINATION lib
        ARCHIVE DESTINATION lib )


message(STATUS ${LIB_LIST})
message(STATUS ${EXTRA_LIBS})
message(STATUS ${LIB_RTMP})


#add_executable(rtmpdump rtmpdump.c thread.c)
#target_link_libraries(rtmpdump ${LIB_RTMP}  ${EXTRA_LIBS} ${LIB_LIST})
#
#add_executable(rtmpgw rtmpgw.c thread.c)
#target_link_libraries(rtmpgw ${LIB_RTMP}  ${EXTRA_LIBS} ${LIB_LIST})
#
#add_executable(rtmpsuck rtmpsuck.c thread.c)
#target_link_libraries(rtmpsuck ${LIB_RTMP}  ${EXTRA_LIBS} ${LIB_LIST})
#
#add_executable(rtmpsrv rtmpsrv.c thread.c)
#target_link_libraries(rtmpsrv ${LIB_RTMP}  ${EXTRA_LIBS} ${LIB_LIST})